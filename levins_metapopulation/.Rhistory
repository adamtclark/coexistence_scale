ceq<-numeric(nsp)
for(i in 1:nsp) {
ceq[i]<-(1-population$mlst[i]/population$clst[i])-sum(ceq[0:(i-1)]*(1+population$clst[0:(i-1)]/population$clst[i]))
}
ceq
}
gridout<-makegrid(xlng = 100, ylng = 100)
population<-populate(gridout, clst = c(0.15, 0.8, 50), mlst = rep(0.1, 4), radlst = Inf)
getceq(population)
population<-populate(gridout, clst = c(0.15, 0.5, 50), mlst = rep(0.1, 4), radlst = Inf)
getceq(population)
population<-populate(gridout, clst = c(0.15, 0.3, 50), mlst = rep(0.1, 4), radlst = Inf)
getceq(population)
gridout<-makegrid(xlng = 100, ylng = 100)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 50), mlst = 0.1, radlst = Inf)
getceq(population)
populate<-function(gridout, nlst=0.1, clst=c(3,20), mlst=rep(0.1, length(clst)), radlst=3) {
if(sum(nlst)<1) {
nlst<-rep(round(prod(gridout$lng)*nlst), length(clst))
while(sum(nlst)/prod(gridout$lng)>1) {
nlst<-nlst/(prod(gridout$lng)*1.2)
nlst<-round(nlst)
}
}
spid<-factor(rep(1:length(nlst), nlst)) #species identities
deathdate<-NULL #scheduled date of death
#radlst #dispersal distance for each species
#species locations
pos_sp<-sample(1:length(gridout$xpos), sum(nlst))
patch_occupied<-numeric(length(gridout$xpos))
patch_occupied[pos_sp]<-1
return(list(spid=spid, nlst=nlst, clst=clst, mlst=mlst, radlst=radlst, pos_sp=pos_sp, patch_occupied=patch_occupied))
}
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 50), radlst = Inf)
getceq(population)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 1), radlst = Inf)
getceq(population)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 2), radlst = Inf)
getceq(population)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 5), radlst = Inf)
getceq(population)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 5, 10), radlst = Inf)
getceq(population)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 5, 20), radlst = Inf)
getceq(population)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 5, 30), radlst = Inf)
getceq(population)
gridout<-makegrid(xlng = 100, ylng = 100)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 5, 30), radlst = Inf)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 5, 30), radlst = Inf)
getceq(population)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 4, 30), radlst = Inf)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 3, 30), radlst = Inf)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 3, 20), radlst = Inf)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
plot(gridout$xpos, gridout$ypos, col=out$full$speciesid, pch=16)
plot_metapop(out)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 3, 15), radlst = Inf)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
plot(gridout$xpos, gridout$ypos, col=out$full$speciesid, pch=16)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population, talktime = 0)
plot_metapop(out1)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
plot(gridout$xpos, gridout$ypos, col=out$full$speciesid, pch=16)
str(population)
population$nlst
out$output
out$output[nrow(out$output),-1]
str(population)
population$radlst
head(out)
out$full$colsites
out$full$speciesid
population$patch_occupied
hist(population$patch_occupied)
out$full$speciesid
as.numeric(out$full$speciesid>0)
population$pos_sp
length(population$pos_sp)
hist(population$pos_sp)
out$full$speciesid
population$spid
out$full$pncolsites
out$full$speciesid
population$pos_sp
out$plotdata
out$output
out$full$speciesid
population$spid
table(population$spid)
table(out$full$speciesid)
sum(table(out$full$speciesid))
population$nlst
population$spid
out$full$speciesid
out$plotdata$ngrid
out$plotdata$ceq
out$full$abundances
rep(1:4, c(1,2,3))
population$nlst
snp<-population$nlst
snp<-length(population$nlst)
snp<-length(population$nlst)
spid<-NULL
out$full$abundances
out$full$abundances[i]
snp<-length(population$nlst)
spid<-NULL
for(i in 1:snp) {
spid<-c(spid, rep(i, out$full$abundances[i]))
}
spid
table(spid)
snp<-length(population$nlst)
spid<-NULL
for(i in 1:snp) {
spid<-c(spid, rep(i, out$full$abundances[i]))
}
spid<-factor(spid, levels=1:snp)
spid
factor(c(1,2,3,5), levels=1:5)
factor(c(1,3,5), levels=1:5)
as.numeric(factor(c(1,3,5), levels=1:5))
snp<-length(population$nlst)
spid<-NULL
for(i in 1:snp) {
spid<-c(spid, rep(i, out$full$abundances[i]))
}
spid<-factor(spid, levels=1:snp)
population$nlst
population$clst
population$mlst
population$radlst
population$pos_sp
population$patch_occupied
length(population$patch_occupied)
out$plotdata$ngrid
snp<-length(population$nlst)
spid<-NULL
pos_sp<-numeric(out$plotdata$ngrid)
out$full$abundances[i]
legnth(population$pos_sp)
length(population$pos_sp)
snp<-length(population$nlst)
spid<-NULL
pos_sp<-NULL
out$full$speciesid
snp<-length(population$nlst)
spid<-NULL
pos_sp<-NULL
for(i in 1:snp) {
spid<-c(spid, rep(i, out$full$abundances[i]))
pos_sp<-c(pos_sp, which(out$full$speciesid==i))
}
pos_sp
length(pos_sp)
length(spid)
snp<-length(population$nlst)
spid<-NULL
pos_sp<-NULL
i<-1
length(rep(i, out$full$abundances[i]))
length( which(out$full$speciesid==i))
out$full$abundances[i]
out$full$speciesid
table(out$full$speciesid)
out$full$abundances
length(rep(i, out$full$abundances[i-1]))
i
out$full$abundances
length(rep(i, out$full$abundances[i]))
length(which(out$full$speciesid==(i-1)))
snp<-length(population$nlst)
spid<-NULL
pos_sp<-NULL
for(i in 1:snp) {
spid<-c(spid, rep(i, out$full$abundances[i]))
pos_sp<-c(pos_sp, which(out$full$speciesid==(i-1)))
}
spid<-factor(spid, levels=1:snp)
head(pos_sp)
length(pos_sp)
length(spid)
snp<-length(population$nlst)
spid<-NULL
pos_sp<-NULL
for(i in 1:snp) {
spid<-c(spid, rep(i, out$full$abundances[i]))
pos_sp<-c(pos_sp, which(out$full$speciesid==(i-1)))
}
spid<-factor(spid, levels=1:snp)
patch_occupied<-numeric(length(gridout$xpos))
patch_occupied[pos_sp]<-1
sum(patch_occupied)
sum()out$full$abundances
sum(out$full$abundances)
rewrap_pop<-function(out, population) {
snp<-length(population$nlst)
spid<-NULL
pos_sp<-NULL
for(i in 1:snp) {
spid<-c(spid, rep(i, out$full$abundances[i]))
pos_sp<-c(pos_sp, which(out$full$speciesid==(i-1)))
}
spid<-factor(spid, levels=1:snp)
patch_occupied<-numeric(length(gridout$xpos))
patch_occupied[pos_sp]<-1
population<-list(spid=spid,
nlst=out$output[nrow(out$output),-1],
clst=population$clst,
mlst=population$mlst,
radlst=population$radlst,
pos_sp=pos_sp,
patch_occupied=patch_occupied)
population
}
plot(gridout$xpos, gridout$ypos, col=out$full$speciesid, pch=16)
plot(gridout$xpos, gridout$ypos, col=out$full$speciesid, pch=16)
population1<-rewrap_pop(out, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
gridout<-makegrid(xlng = 100, ylng = 100)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 3, 15), radlst = Inf)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
plot(gridout$xpos, gridout$ypos, col=out$full$speciesid, pch=16)
out1<-out
population1<-rewrap_pop(out, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
population1<-rewrap_pop(out, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
population1<-rewrap_pop(out, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
population1<-rewrap_pop(out, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
population1<-rewrap_pop(out, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
population1<-rewrap_pop(out, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
population1<-rewrap_pop(out, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
population1<-rewrap_pop(out, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
gridout<-makegrid(xlng = 100, ylng = 100)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 3, 15), radlst = 10)#radlst = Inf)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
plot(gridout$xpos, gridout$ypos, col=out$full$speciesid, pch=16)
out1<-out
population1<-rewrap_pop(out, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
out1$full$speciesid
table(out1$full$speciesid)
sum(table(out1$full$speciesid))
population1$nlst
population$nlst
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=10, nsteps = 10, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
#load functions
source("run_metapopulation_wrapper.R")
gridout<-makegrid(xlng = 100, ylng = 100)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 3, 15), radlst = 10)#radlst = Inf)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
plot(gridout$xpos, gridout$ypos, col=out$full$speciesid, pch=16)
out1<-out
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population<-populate(gridout, clst = c(0.15, 0.3), radlst = 2)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
plot(gridout$xpos, gridout$ypos, col=out$full$speciesid, pch=16)
out1<-out
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
out1$full$speciesid
table(out1$full$speciesid)
sum(table(out1$full$speciesid))
gridout<-makegrid(xlng = 100, ylng = 100)
population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 3, 15), radlst = Inf)
population$nlst
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
plot(gridout$xpos, gridout$ypos, col=out$full$speciesid, pch=16)
out1<-out
out$full$speciesid
table(out$full$speciesid)
population$nlst
length(population$nlst)
tmp<-out$full$speciesid; tmp[tmp==length(population$nlst)]<-NA
plot(gridout$xpos, gridout$ypos, col=tmp, pch=16)
out1<-out
#population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 3, 15), radlst = Inf)
population<-populate(gridout, clst = c(0.15, 0.3), radlst = 2)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
tmp<-out$full$speciesid; tmp[tmp==length(population$nlst)]<-NA
plot(gridout$xpos, gridout$ypos, col=tmp, pch=16)
tmp
plot(gridout$xpos, gridout$ypos, col=tmp+1, pch=16)
table(tmp)
sum(table(tmp))
out$full$abundances
sum(out$full$abundances)
plot_metapop(out)
tmp<-out$full$speciesid; tmp[tmp==length(population$nlst)]<-NA
plot(gridout$xpos, gridout$ypos, col=tmp+1, pch=16)
out1<-out
plot_metapop(out)
tmp<-out$full$speciesid; tmp[tmp==length(population$nlst)]<-NA
plot(gridout$xpos, gridout$ypos, col=tmp+1, pch=16)
out1<-out
population1<-rewrap_pop(out1, population)
population1$spid
table(population1$spid)
population1$nlst
population1$clst
population1$mlst
population1$radlst
population1$pos_sp
length(population1$pos_sp)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot(gridout$xpos, gridout$ypos, col=out1$full$speciesid, pch=16)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
tmp<-out1$full$speciesid; tmp[tmp==length(population1$nlst)]<-NA
plot(gridout$xpos, gridout$ypos, col=tmp+1, pch=16)
out$full$pnsp
plot_map<-function(gridout, out) {
tmp<-out$full$speciesid; tmp[tmp==out$full$pnsp]<-NA
plot(gridout$xpos, gridout$ypos, col=tmp+1, pch=16)
}
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot_map<-function(out, gridout) {
tmp<-out$full$speciesid; tmp[tmp==out$full$pnsp]<-NA
plot(gridout$xpos, gridout$ypos, col=tmp+1, pch=16)
}
plot_map(out1, gridout)
error
rm(list=ls())
setwd("~/Dropbox/Projects/032_Coexistence_mechanisms/src/levins_metapopulation/")
#load functions
source("run_metapopulation_wrapper.R")
gridout<-makegrid(xlng = 100, ylng = 100)
#population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 3, 15), radlst = Inf)
population<-populate(gridout, clst = c(0.15, 0.3), radlst = 2)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
plot_map(out, gridout)
out1<-out
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot_map(out1, gridout)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot_map(out1, gridout)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot_map(out1, gridout)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot_map(out1, gridout)
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot_map(out1, gridout)
#population<-populate(gridout, clst = c(0.15, 0.3, 0.8, 3, 15), radlst = Inf)
population<-populate(gridout, clst = c(0.15, 0.3), radlst = 10)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
plot_map(out, gridout)
out1<-out
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot_map(out1, gridout)
population<-populate(gridout, clst = c(0.15, 0.3), radlst = 20)
getceq(population)
out<-run_metapopulation(tmax=500, nsteps = 1000, gridout, population, talktime = 10)
plot_metapop(out)
plot_map(out, gridout)
out1<-out
population1<-rewrap_pop(out1, population)
out1<-run_metapopulation(tmax=500, nsteps = 100, gridout, population1, talktime = 0)
plot_metapop(out1)
plot_map(out1, gridout)
plot_metapop(out1)
getceq(population)
plot_metapop(out)
plot_metapop(out1)
